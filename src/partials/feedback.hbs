<div id="feedback" class="feedback-wrapper">
    <h2>Was this page helpful?</h2>
    <div id="feedback-stars" class="stars" data-stars="">
        <svg height="25" width="23" class="star rating" data-rating="1">
            <polygon points="9.9, 1.1, 3.3, 21.78, 19.8, 8.58, 0, 8.58, 16.5, 21.78" style="fill-rule:nonzero;"/>
        </svg>
        <svg height="25" width="23" class="star rating" data-rating="2">
            <polygon points="9.9, 1.1, 3.3, 21.78, 19.8, 8.58, 0, 8.58, 16.5, 21.78" style="fill-rule:nonzero;"/>
        </svg>
        <svg height="25" width="23" class="star rating" data-rating="3">
            <polygon points="9.9, 1.1, 3.3, 21.78, 19.8, 8.58, 0, 8.58, 16.5, 21.78" style="fill-rule:nonzero;"/>
        </svg>
        <svg height="25" width="23" class="star rating" data-rating="4">
            <polygon points="9.9, 1.1, 3.3, 21.78, 19.8, 8.58, 0, 8.58, 16.5, 21.78" style="fill-rule:nonzero;"/>
        </svg>
        <svg height="25" width="23" class="star rating" data-rating="5">
            <polygon points="9.9, 1.1, 3.3, 21.78, 19.8, 8.58, 0, 8.58, 16.5, 21.78" style="fill-rule:nonzero;"/>
        </svg>
    </div>
    <div id="feedback-form">
        <form action="#">
            <label>
                <span>
                Name:
                </span>
                <input placeholder="Name" id="feedback-name" />
            </label>
            <label>
                Email:
                <input placeholder="Email" id="feedback-email" />
            </label>
            <label>
                Suggestions:
                <textarea placeholder="Suggestions" id="feedback-suggestions"></textarea>
            </label>
            <button type="submit">Submit</button>
        </form>
    </div>
    <div id="feedback-thankyou">
        <span>Thank you for your Feedback!</span>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelector('#feedback-form form').addEventListener('submit', function(evt) {
            evt.preventDefault();

            const feedbackInfo = {
            email: "docs@datastax.com",
            subject: `Feedback | ${document.querySelector('h1.page')?.innerText}`,
            message:
`
Page: <a href="${window.location.href}">${document.querySelector('h1.page')?.innerText ?? ""}</a>
Rating: ${document.querySelector('#feedback-stars').getAttribute('data-stars')}

Name: ${document.querySelector('#feedback-name').value}
Email: ${document.querySelector('#feedback-email').value}
Suggestions: ${document.querySelector('#feedback-suggestions').value}
`
            };

            //console.log('feedbackInfo', feedbackInfo);
            var oReq = new XMLHttpRequest();
            oReq.addEventListener("load", function() {
                document.querySelector('#feedback-stars').style.display = 'none';
                document.querySelector('#feedback-form').style.display = 'none';
                document.querySelector('#feedback-thankyou').style.display = 'block';
            });
            oReq.open("POST", "https://contact.api.docs.datastax.com/contact-us");
            oReq.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            oReq.send(JSON.stringify(feedbackInfo));
        });

        document.querySelector('#feedback-stars').addEventListener('click', function(evt) {
            let rating = null;
            if(evt.target.tagName === "polygon") {
                rating = evt.target.parentNode.getAttribute('data-rating');
            } else if(evt.target.tagName === "svg") {
                rating = evt.target.getAttribute('data-rating');
            }

            if(!!rating) {
                document.querySelector('#feedback-stars').setAttribute('data-stars', rating);
                document.querySelector('#feedback-form').style.display = 'block';
            }
        });
    });
</script>
