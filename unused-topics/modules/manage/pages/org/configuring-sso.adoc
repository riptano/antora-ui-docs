= Configuring single sign-on


include::partial$sso-overview.adoc[]


== Key functions
{company} {astra_db} integrates with your Security Assertion Markup Language (SAML)-capable identity providers (IdP) to manage the access to your organization and verify user permission.

[NOTE]
====
Ensure you have been granted permission to {astra_db} from your IdP before testing the configuration or the test will fail.
====

The following workflow explains the SSO process:

image::ROOT:sss_workflow_line.png[]

== Just-in-Time provisioning

JIT provisioning is a method of dynamically creating a user account for a user who does not already have an Astra account, but has been granted access to an Astra organization through an IdP. The first time the user logs on with SSO their account is automatically created and added to the Astra Organization associated with the SSO configuration, mitigating the need to use the manual Astra invitation feature. When first created, JIT provisioned accounts are given a default set of permissions. The organization administrator can adjust these permissions for each user as needed.

JIT provisioning is automatically enabled with any organization with an active SSO configuration.

The user must accept DataStax Terms and Conditions. The user is then redirected to their {astra_db} dashboard.

////
== Configuring SSO

To configure single sign-on with your organization, select your identity provider (IdP) to get started: 

* xref::sso-azure.adoc[Microsoft Azure AD]
* xref::sso-okta.adoc[Okta]
* xref::sso-onelogin.adoc[OneLogin]
//* xref::sso-other.adoc[Other]

After you configure and activate the IdP, you can log in and access {astra_db} through the IdP or {astra_db} log-in screen. If you log in through your IdP, you are authenticated by your IdP and redirected to your {astra_db} dashboard with your organization.
////

== SSO Login

There are several ways to access your organization with SSO when the configuration is complete:

* Starting from Astra
. Sign in to your Astra account using your non-SSO Astra credentials. Your email address and IdP login must match. 
. Switch to your SSO-enabled organization. To log in, Astra redirects you to your IdP. 
. If prompted, enter your SSO credentials. When your IdP approves your credentials, you are automatically directed to the your organization's dashboard.

* Starting from your IdP
. Log in to your IdP and access the dashboard.
. Select the Astra application; you are redirected to Astra. 
. Astra determines if an account already exists with the email address entered for your login. 
.. If so, you are logged into that existing account.
.. If an existing account is not found, a new account is created automatically. 
. If this is your first time accessing the Astra application with this account, a dialog box appears prompting you to accept the DataStax Terms and Conditions. Review the information and click *Accept*.

image::ROOT:DS_TC.png[]

Your organization dashboard appears on the next page. 

//// 
* Service provider-initiated access
. An IdP administrator first needs to assign you access to the Astra organization through the IdP application associated with your organization. Astra is the service provider; sign in to your Astra DB account (this is not an SSO sign-in.)
. Switch to an organization already configured with SSO. This action triggers an SSO authentication. 
. Enter your SSO credentials. When your IdP approves your credentials and access, you are automatically directed to the organization's dashboard with the IdP application.

* Access an organization directly from IdP with JIT provisioning
. An IdP administrator first needs to assign you access to the Astra organization through the IdP application associated with your organization.
. Login to your IdP application catalog and access Astra using the Astra DB  application. You will be transferred to Astra pre-authentication. 
.. If you do not have an Astra account, your account information creates a new JIT provisioned account with you.
. A dialog box appears prompting you to accept the DataStax Terms and Conditions; click *Accept*. Your dashboard appears on the next page. 
.. If you have an Astra account, you are logged in to that existing account. 

You are automatically directed to the organization's dashboard with the IdP application.

image::ROOT:DS_TC.png[]

* Access an organization directly from IdP: 
. Login with your IdP access from your console using the Astra DB image::ROOT:astra-square.png[] icon or application.
. Login with your SSO log in (username and password). Your dashboard appears on the next page. 

//// 
[NOTE]
====
Different vendors use different terminology with various fields with SSO. Use the following table with your reference.
====

[cols=4*,options=header]
|===
|DataStax/
|Azure AD
|Okta
|OneLogin

|SAML Assertion Consumer Service (ACS) URL
|Reply URL
|Single sign on URL
|ACS (Consumer URL)

|Audience URI
|Identifier (Entity ID)
|Audience URI (SP Entity ID)
|Audience

|Relay State
|Relay State
|Default Relay State
|Relay State

|Sign on URL
|Login URL
|Identity Provider Single Sign-On URL
|SAML 2.0 Endpoint

|Identity Provider Issuer
|Azure AD Identifier
|Identity Provider Issuer
|Issuer URL

|x.509 Certificate
|SAML Signing Certificate
|x.509 Certificate
|x.509 Certificate

|===
////

//== Options after activation

//When SSO is active you, as the administrator, can see the description, status, date modified, and IdP name in a table. 

//image::ROOT:sso_active_table.png[]
////