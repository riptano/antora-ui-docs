= Connect to Google Cloud private endpoints via {astra_db} console

To better protect your database connection, you can connect to a private endpoint using the {astra_db} console.

For details about using API calls instead, see xref:manage:devops/devops-gcp-private-endpoints.adoc[Connect to Google Cloud Private Service Connect with the DevOps API, window="_blank"].


[IMPORTANT]
====
This information applies to only serverless databases.

Also, private endpoints are available for only intra-region use. The **region** for your private endpoint in Google Cloud and your {astra_db} database **must match**.
====

For pricing related to using private endpoints, see xref:manage:org/managing-org.adoc#private-endpoints[Pricing and billing].

include::ROOT:partial$endpoint_perm.adoc[]

For more, see link:https://cloud.google.com/blog/products/networking/introducing-private-service-connect[Google Cloud Private Service Connect].

== Prerequisites

. Access to your existing Google Cloud project.
. xref:manage:db/managing-db.adoc#_create_your_database[Create your {astra_db} database] using the {astra_db} console.
. Ensure you have xref:manage:org/managing-org.adoc#_manage_user_permissions[permission] to manage private endpoints.
. From the link:https://console.cloud.google.com/net-services/psc/[Google Cloud Console], get your *Project ID*.
. Create a Google Cloud Console network, subnetwork, and IP address for your private endpoint. For more, see link:https://cloud.google.com/vpc/docs/using-vpc#creating_networks[Creating networks]. The steps for private endpoints and sample values are listed below.
. Take note of which **region** your Google Cloud project and Google Cloud based {astra_db} use (the chosen region **must match**).


[NOTE]
====
To increase your security, xref:manage:db/manage-access-list.adoc[restrict public access] to your database using the access list.
====

== Creating and referencing endpoint values between Google Cloud and {astra_db} consoles

Setting up the connection between Google Cloud and {astra_db} private endpoints involves a few steps in both consoles.

=== Let's start in {astra_db} console

. On your organization's {astra_db} dashboard, click the link for your active, Google Cloud based database.
. Navigate to your database's **Settings** tab, and notice the **Private Endpoints** section. At this point, no endpoints have been linked. Example:
+
image::astra-db-settings-tab-private-endpoints.png[{astra_db} console Settings tab with Private Endpoints section]
+
. Click **Configure Region** and enter your Google Cloud **Project ID** as listed in Google Cloud Console.
. After entering your Google Cloud project-ID, click **Configure Region**.
. {astra_db} console displays an updated Private Endpoints section, which includes a newly generated Service Name.
. Click **Add Endpoint**.
. On **Add Private Endpoint**, copy the generated **Service Name**. Example:
+
image::astra-db-settings-private-endpoints-copy-service-name.png[{astra_db} Add Private Endpoint copy Service Name]
+

[TIP]
====
In {astra_db} console, keep the **Add Private Endpoint** dialog open. We'll return here with an **Endpoint ID** after creating it in Google Cloud Console.
Also note the region defined for your database. In this example, it is `us-east4`.
====

=== Switch over to Google Cloud Console

Ensure you're in the Google Cloud project you identified above. Then:

. Navigate to link:https://console.cloud.google.com/net-services/psc/[Private Service Connect].
. So far in this example, no Google Cloud endpoint has been created:
+
image::gcp-private-service-connect0.png[Google Cloud Private Connect Service with no endpoint created yet]
+
. Click **+ CONNECT ENDPOINT**.
. On the  **Connect Endpoint** dialog, choose or enter:
.. Target: Published service.
.. Target service: Paste in the Service Name value that you copied in {astra_db} console.
.. Endpoint name: Enter any name, such as `astra-google-cloud-endpoint`. The name must start with a lowercase letter followed by up to 19 lowercase letters and numbers.
.. Network: Enter a network value. In this example, we entered `default`.
.. Subnetwork: Enter a subnetwork value, such as `default`.
.. IP address: If not already assigned, click **CREATE IP ADDRESS**. On the form, enter a name such as `static-address`. Have Google Cloud assign the IP address automatically, or choose your own value.
+
image::gcp-connect-endpoint-reserve-static-ip-address.png[Google Cloud Connect Endpoint with Reserve Static IP Address dialog]
+
Click **RESERVE**.
.. Region: Google Cloud sets the region from a portion of the Service Name that you pasted into the **Target service** field above. (Verify that the specified region is what you intended!) In this example, we're using `us-east4`.
. Click **ADD ENDPOINT**.

Once accepted, Google Cloud displays data for the added endpoint. Example:

image::gcp-private-service-connect-added-endpoint-example.png[Google Cloud Private Service Connect added Endpoint example]

Click the linked name of your newly added Endpoint to display the details screen in Google Cloud Console, and **copy** the Private Service Connect (PSC) ID. Example:

image::gcp-endpoint-details-copy-psc-id.png[Google Cloud Private Service Connect details, copy the PCS ID]

You'll need to paste in that **PCS ID** value in {astra_db} console.

=== Return to {astra_db} console

Back in {astra_db} console, return to the **Add Private Endpoint** dialog that's available from your databases's Settings.

. In the Endpoint ID field, paste in the copied **PSC ID** value. Also enter a brief description of your {astra_db} / Google Cloud endpoint.
. Click **Add Endpoint**.
+
{astra_db} displays the result. Example:
+
image::astra-db-settings-private-endpoint-added.png[{astra_db} Settings Private Endpoint details]

Your private endpoint is defined. However, notice the warning message if you have not taken further action in your {astra_db} Settings.

[IMPORTANT]
====
Youâ€™ve set up a private endpoint for this database, but access to your database is still open to the public. Learn how to xref:manage:db/manage-access-list.adoc[Manage access lists for public access, window="_blank"] by using the **IP Access List** options in {astra_db} console **Settings**. You can enable the Restrict public access toggle, and you can manage endpoints with one or more access lists.
====

== Create a DNS entry for your private endpoint

You can alias your private endpoint with a DNS record to use as your hostname in the {astra_db} xref:connecting.adoc#_downloading_secure_connect_bundle[secure connect bundle]. Here are the steps:

. Download your secure connect bundle for the region of your choice. Get your latest xref:connecting.adoc#_downloading_secure_connect_bundle[secure connect bundle].
. Unzip the secure connect bundle.
. In `config.json`, copy the `host` key's value.
. In Google Cloud Console, create a private zone to route traffic to your endpoint IP. Update the domains to use REST and CQL. Examples:
+
[tabs]
====
REST::
+
--
[source,shell, subs="attributes+"]
----
efe451fe-709e-4700-9185-5cf0fd3474a7-2-us-east-1.apps.astra.datastax.com
----
--

CQL::
+
--
[source,plaintext, subs="attributes+"]
----
efe451fe-709e-4700-9185-5cf0fd3474a7-2-us-east-1.db.astra.datastax.com
----
--
====
+
See link:https://cloud.google.com/dns/zones#create-private-zone[Create a private zone].

Once those steps are completed, you can connect to your private endpoint using your updated secure connect bundle. For more, see xref:ROOT:connecting-to-astra-databases-using-datastax-drivers.adoc[Drivers for Astra DB].

== Remove a private endpoint

In Google Cloud Console:

. Go to link:https://console.cloud.google.com/net-services/psc/[Private Service Connect, window="_blank"].
. Choose the endpoint you want to remove.
. Choose *Delete*.

In {astra_db} console:

. Go to the **Settings** tab for your database.
. Choose the endpoint you want to remove.
. Click **Delete**.

== What's next?

* Refer to related topics for other cloud providers that are linked from xref:connect:private_endpoints/connect-private-endpoints.adoc[Connect via a private endpoint, window="_blank"].
* Learn how to xref:manage:db/manage-access-list.adoc[Manage access lists for public access, window="_blank"].
* For more, see link:https://cloud.google.com/vpc/docs/private-service-connect[Private Service Connect] and the link:_attachments/devopsv2.html#operation/Private-Endpoints[DevOps API reference, window="_blank"].
