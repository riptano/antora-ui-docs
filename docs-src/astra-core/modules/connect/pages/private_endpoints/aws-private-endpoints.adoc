= Connect to AWS Private Endpoints via {astra_ui}

To better protect your database connection, you can connect to a private endpoint using {astra_ui}.

For details about using API calls instead, see xref:manage:devops/devops-aws-private-endpoints.adoc[Connect to AWS Private Link with the DevOps API, window="_blank"].

[IMPORTANT]
====
This information applies to only serverless databases.

Also, Private endpoints are available for only intra-region use. The **region** for your private endpoint in AWS and your {astra_db} database **must match**.
====

For pricing related to using private endpoints, see xref:manage:org/managing-org.adoc#private-endpoints[Pricing and billing].

include::ROOT:partial$endpoint_perm.adoc[]

For more about AWS PrivateLink, see link:https://docs.aws.amazon.com/vpc/latest/privatelink/endpoint-service.html[VPC endpoint services (AWS PrivateLink)].

== Prerequisites

. Access to your existing AWS organization and account.
. xref:manage:db/managing-db.adoc#_create_your_database[Create your {astra_db} database] using {astra_ui}.
. Ensure you have xref:manage:org/managing-org.adoc#_manage_user_permissions[permission] to manage private endpoints.
. Take note of which **region** your AWS organization and AWS-based {astra_db} use (the chosen region **must match**).

[IMPORTANT]
====
In AWS, only VPC owners can create resources such as VPC endpoints, subnets, route tables, and NACLs. Participants cannot view, modify, or delete resources that belong to other participants or the VPC owner. Thus a user cannot create resources, including a private endpoint, in a shared VPC that is owned by a different AWS account. To see which account owns your VPC, look at the Owner ID in the AWS Console. Example:

image::ROOT:aws-vpc-owner-id-example.png[alt=Look at Owner ID in AWS Console,width=300]


For more, see link:https://docs.aws.amazon.com/vpc/latest/userguide/vpc-sharing.html[Work with shared VPCs - Amazon Virtual Private Cloud].
====

[NOTE]
====
To increase your security, xref:manage:db/manage-access-list.adoc[restrict public access] to your database using the access list.
====

== Creating and referencing endpoint values between AWS and {astra_ui}s

Setting up the connection between AWS and {astra_db} private endpoints involves a few steps in both consoles.

=== Let's start in {astra_ui}

. On your organization's {astra_db} dashboard, click the link for your active, AWS-based database.
. Navigate to your database's **Settings** tab, and notice the **Private Endpoints** section. At this point, no endpoints have been linked. Example:
+
image::astra-db-settings-tab-private-endpoints-aws.png[{astra_ui} Settings tab with Private Endpoints section for AWS]
+
. Click **Configure Region** and enter your AWS account's Amazon Resource Name (ARN), which includes your AWS account number, in this format:
+
`arn:aws:iam::<your-aws-account-id>:root`
+
. After entering the ARN, click **Configure Region**.
. {astra_ui} displays an updated Private Endpoints section.
. Click **Add Endpoint**.
. On **Add Private Endpoint**, copy the generated **Service Name**.

[TIP]
====
In {astra_ui}, keep the **Add Private Endpoint** dialog open. We'll return here with an **Endpoint ID** after creating it in AWS console.
====

=== Switch over to AWS console

. After authenticating into your AWS organization and account, start on \https://console.aws.amazon.com/vpc/home?region=`<your-region-here>`#Endpoints:sort=vpcEndpointId or search in AWS console for "Create Endpoint".
+
[TIP]
====
In your AWS account, make sure you're using the same region as the one used by {astra_db}. If necessary, switch to the region specified when you created your {astra_db}.
====
+
. Click **Create Endpoint**.
. On the AWS **Create Endpoint** dialog, choose or enter:
.. Service category: Find service by name
.. Service Name: Paste in the Service Name value that you copied in {astra_ui}.
.. Click *Verify** to check that the Service Name copied from {astra_db} is correct.
. Click **Create endpoint**.
. Click **Verify** to ensure the Service Name is found. Example after verification:
+
image::aws-private-service-connect-added-endpoint-example.png[AWS Private Service Connect added Endpoint example]
+
. Once accepted, AWS displays data for the added endpoint. **Copy** the generated Virtual Private Cloud (VPC) Endpoint ID. You'll need to paste in that **VPC Endpoint ID** value in {astra_ui}.

=== Return to {astra_ui}

Back in {astra_ui}, return to the **Add Private Endpoint** dialog that's available from your databases's Settings.

. In the Endpoint ID field, paste in the copied **VPC Endpoint ID** value. Also enter a brief description of your {astra_db} / AWS endpoint.
. Click **Add Endpoint**.
+
{astra_db} displays the result. Example:
+
image::astra-db-settings-private-endpoint-added-aws.png[{astra_db} Settings Private Endpoint details]

Your private endpoint is defined. However, notice the warning message if you have not taken further action in your {astra_db} Settings.

[IMPORTANT]
====
Youâ€™ve set up a private endpoint for this database, but access to your database is still open to the public. Learn how to xref:manage:db/manage-access-list.adoc[Manage access lists for public access, window="_blank"] by using the **IP Access List** options in {astra_ui} **Settings**. You can enable the Restrict public access toggle, and you can manage endpoints with one or more access lists.
====

== Create a DNS entry for your private endpoint

You can alias your private endpoint with a DNS record to use as your hostname in the {astra_db} xref:connect:connecting.adoc#_downloading_secure_connect_bundle[secure connect bundle]. Here are the steps:

. Download your secure connect bundle for the region of your choice. Get your latest xref:connect:connecting.adoc#_downloading_secure_connect_bundle[secure connect bundle].
. Unzip the secure connect bundle.
. In `config.json`, copy the `host` key's value.
. In AWS Console:
.. Create a CNAME record that points to the DNS name found in your VPC Endpoint details.
.. Create a private zone to route traffic to your virtual IP using Amazon Route 53. Update the domains to use REST and CQL. Examples:
+
[tabs]
====
REST::
+
--
[source,shell, subs="attributes+"]
----
efe451fe-709e-4700-9185-5cf0fd3474a7-2-us-east-1.apps.astra.datastax.com
----
--

CQL::
+
--
[source,plaintext, subs="attributes+"]
----
efe451fe-709e-4700-9185-5cf0fd3474a7-2-us-east-1.db.astra.datastax.com
----
--
====
+
See link:https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-to-vpc-interface-endpoint.html[Configuring Amazon Route 53 to route traffic to an Amazon VPC interface endpoint].

Once those steps are completed, you can connect to your private endpoint using your updated secure connect bundle. For more, see xref:connect:connecting-to-astra-databases-using-datastax-drivers.adoc[Drivers for Astra DB].

== Remove a private endpoint

In AWS console:

. Go to \https://console.aws.amazon.com/vpc/home?region=`<your-region-here>`#Endpoints:sort=vpcEndpointId
+
Example link with `us-east-1`:
+
\https://console.aws.amazon.com/vpc/home?region=us-east-1#Endpoints:sort=vpcEndpointId[Create Endpoint, window="_blank"]
. Select the checkbox for the endpoint(s) you want to remove.
. From the AWS Actions drop-down menu, choose **Delete Endpoint**.

In {astra_ui}:

. Go to the **Settings** tab for your database.
. Choose the endpoint you want to remove.
. Click **Delete**.

== What's next?

* Refer to related topics for other cloud providers that are linked from xref:connect:private_endpoints/connect-private-endpoints.adoc[Connect via a private endpoint, window="_blank"].
* Learn how to xref:manage:db/manage-access-list.adoc[Manage access lists for public access, window="_blank"].
* For more, see link:https://aws.amazon.com/privatelink[AWS PrivateLink, window="_blank"].
